<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Survey</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>
</head>

<body>
  <div class="container">
    <h2>Survey Questions</h2>
    <hr>

    <h3><strong>About You</strong></h3>
    <h4>Name (Required)</h4>
    <input type="text" id="name" class="form-control" required>

    <h4>Link to Photo Image (Required)</h4>
    <input type="text" id="photo" class="form-control" required>
    <hr>

    <h3><strong>Question 1</strong></h3>
    <h4>You love nature.</h4>
    <select class="chosen-select" id="q1">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>

    <h3><strong>Question 2</strong></h3>
    <h4>You love dogs.</h4>
    <select class="chosen-select" id="q2">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>


    <h3><strong>Question 3</strong></h3>
    <h4>You are spontaneous and you may decide to take a trip on a whim.</h4>
    <select class="chosen-select" id="q3">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>


    <h3><strong>Question 4</strong></h3>
    <h4>You enjoy reading, especially comic books.</h4>
    <select class="chosen-select" id="q4">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>


    <h3><strong>Question 5</strong></h3>
    <h4>You enjoy all sorts of music, including classical music.</h4>
    <select class="chosen-select" id="q5">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>


    <h3><strong>Question 6</strong></h3>
    <h4>You go to the musuem everytime there is a new exibit.</h4>
    <select class="chosen-select" id="q6">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>


    <h3><strong>Question 7</strong></h3>
    <h4>You enjoy going to galleries.</h4>
    <select class="chosen-select" id="q7">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>

    <h3><strong>Question 8</strong></h3>
    <h4>You read the art section of the NYT religiously.</h4>
    <select class="chosen-select" id="q8">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>

    <h3><strong>Question 9</strong></h3>
    <h4>You love foreign films.</h4>
    <select class="chosen-select" id="q9">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>

    <h3><strong>Question 10</strong></h3>
    <h4>You enjoy lovely walks in the forest or by a river.</h4>
    <select class="chosen-select" id="q10">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>

    <br>
    <br>

    <!-- Submit Button -->
    <button type="submit" class="btn btn-primary btn-lg btn-block" id="submit"><i class="fa fa-check-circle" aria-hidden="true"></i>
     Submit</button>


    <hr>
    <footer class="footer">
      <div class="container">
       <p><a href="api/data/friends">API Friends List</a> | <a href="https://github.com/urani100/FriendFinder">GitHub Repo</a></p>
      </div>
    </footer>

  </div>

  <!-- Modal -->
  <div id="results-modal" class="modal fade" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title"><strong>Best Match</strong></h2>
        </div>
        <div class="modal-body">
          <h2 id="match-name"></h2>
          <div id="match-img"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>

    </div>
  </div>


<!-- script starts here... To do: Place in diffrent file-->
  <script type="text/javascript">
  $("#submit").on("click", function(event) {
    event.preventDefault();

    //validate form function
    function validateForm() {
        var isValid = true;
        $(".form-control").each(function() {
          if ($(this).val() === "") {
            isValid = false;
          }
        });
        $(".form-control form-control-chosen").each(function() {
          if ($(this).val() === "") {
            isValid = false;
          }
        });
        return isValid;
      }
    
   
   if (validateForm()) {
     //Create a newFriend object 
      var newFriend = {
        name: $("#name").val().trim(),
        photo: $("#photo").val().trim(),
        scores: []
      };
      
    var currentSCore = [];
    var finalScores = [];

      for(var i = 1; i<11; i++){
        var q = "#q" + i;
        var value = $(q).val().trim();
        newFriend.scores.push(value); //push user element in original friends array
        currentSCore.push(value); //push user element in currentSCOre array
      }

    //grab information from the friends array using Ajax and comapare scores
    $.ajax({ url: "api/data/friends", method: "GET" })
      .then(function(friends) {
      
        for(var i= 0; i <4; i++){
          var current = [];
           for(var j=0; j<10; j++){
            current.push(friends[i].scores[j]- parseInt(currentSCore[j]));
          } 
          var sum = current.reduce(function(current, b) { return current + b; }, 0);
          sum = Math.abs(sum);
          finalScores.push(sum);
        }
       
       //find min in array
       var min = Math.min.apply(null, finalScores);

       //find position of min
       var minPos = finalScores.indexOf(min);
       
      //display match name
      $('#match-name').html(friends[minPos].name);

      //display image
      var link = friends[minPos].photo;
      var imageMatch = $("<img>");
      imageMatch.attr("src", link);
      $("#match-img").html(imageMatch);

      //show modal
      $('#results-modal').modal('show');
      
      });

      //posting object to  /api/friends
    $.post("/api/friends", newFriend,
      function(data) {

        // clear the form after submit
        $("#name").val("");
        $("#photo").val("");
        $("#q1").val("");
        $("#q2").val("");
        $("#q3").val("");
        $("#q4").val("");
        $("#q5").val("");
        $("#q6").val("");
        $("#q7").val("");
        $("#q8").val("");
        $("#q9").val("");
        $("#q10").val("");

      });
    }else{
     alert('Form is Incomplete')
  }

  });
  
</script>
</html>
